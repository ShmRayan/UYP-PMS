<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>CrÃ©er une ordonnance - UYP-PMS</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>

<header class="main-header">
    <div class="header-left">
        <img th:src="@{/img/uottawa-logo.png}" class="logo">
        <img th:src="@{/img/pharmacy-icon.png}" class="logo-small">
    </div>

    <div class="header-center">
        <h1>Umelaphi Yaodian Pharmacy Management System</h1>
    </div>

    <div class="header-right">
        <a href="/logout" class="logout-btn">ğŸšª Logout</a>
    </div>
</header>

<nav class="navbar">
    <a href="/dashboard">ğŸ  Dashboard</a>
    <a href="/patients">ğŸ§‘â€âš•ï¸ Patients</a>
    <a href="/prescriptions/create" class="active">ğŸ’Š Create Prescription</a>
</nav>

<main class="container fade-in">

    <div class="edit-header">
        <a href="/prescriptions" class="back-arrow">â† Retour</a>
        <h2>CrÃ©er une ordonnance</h2>
    </div>

    <div th:if="${successMessage}" class="alert alert-success">
        <p th:text="${successMessage}"></p>
    </div>

    <div th:if="${errorMessage}" class="alert alert-error">
        <p th:text="${errorMessage}"></p>
    </div>

    <form action="/prescriptions/create" method="post" class="nice-form">

        <h3 class="section-title">ğŸ‘¤ Informations du patient</h3>

        <div class="form-group">
            <label>Patient</label>
            <select id="patientSelect" name="patientId" required>
                <option value="">-- Choisir un patient --</option>
                <option th:each="p : ${patients}"
                        th:value="${p.healthId.value}"
                        th:text="${p.healthId.value + ' â€” ' + p.name}">
                </option>
            </select>
        </div>

        <div class="form-group">
            <label>ID du prescripteur (mÃ©decin)</label>
            <input type="text" name="prescriberId" required placeholder="ex: AGT-xxx">
        </div>

        <h3 class="section-title">ğŸ’Š DÃ©tails du mÃ©dicament</h3>

        <div class="form-group">
            <label>Nom du mÃ©dicament</label>
            <input type="text" name="drugName" required placeholder="ex: Atorvastatin">
        </div>

        <div class="form-row">
            <div class="form-group half">
                <label>DIN</label>
                <input type="text" name="din" id="dinInput" maxlength="8" required placeholder="ex: 02212345">
            </div>

            <div class="form-group half">
                <label>Dosage</label>
                <input type="text" name="strength" required placeholder="ex: 10 mg">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group half">
                <label>Mode dâ€™administration</label>
                <select name="adminMethod" required>
                    <option value="">-- Choisir --</option>
                    <option>Oral</option>
                    <option>Injection</option>
                    <option>Topique</option>
                    <option>Inhalation</option>
                </select>
            </div>

            <div class="form-group half">
                <label>FrÃ©quence</label>
                <input type="text" name="frequency" required placeholder="ex: 2 fois par jour">
            </div>
        </div>

        <div class="form-group">
            <label>Instructions spÃ©ciales</label>
            <input type="text" name="instructions" rows="3" required placeholder="ex: Ã€ prendre aprÃ¨s un repas">
        </div>

        <div class="form-group">
            <label>QuantitÃ©</label>
            <input type="number" name="quantity" required min="1">
        </div>

        <h3 class="section-title">ğŸ” Renouvellements</h3>

        <div class="form-row">
            <div class="form-group half">
                <label>Type de renouvellement</label>
                <select name="refillType">
                    <option value="NONE">Non-renouvelable</option>
                    <option value="MONTHLY">Mensuel</option>
                    <option value="WEEKLY">Hebdomadaire</option>
                </select>
            </div>

            <div class="form-group half">
                <label>Nombre de renouvellements</label>
                <input type="number" name="refillCount" min="0" value="0">
            </div>
        </div>

        <div class="form-actions">
            <button class="btn-primary">CrÃ©er lâ€™ordonnance</button>
        </div>

    </form>

</main>

<footer class="footer">
    <p>Â© 2025 UYP-PMS | University of Ottawa</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/js/select2.min.js"></script>

<script>
    $("#patientSelect").select2();
    $("#pharmacistSelect").select2();

    $("#dinInput").on("input", function () {
        this.value = this.value.replace(/[^0-9]/g, "").substring(0, 8);
    });
</script>

</body>
</html>
