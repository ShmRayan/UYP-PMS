<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Liste des agents - UYP-PMS</title>
    <link rel="icon" type="image/png" th:href="@{/img/pharmacy-icon.png}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>

<header class="main-header">
    <div class="header-left">
        <img th:src="@{/img/uottawa-logo.png}" alt="uOttawa Logo" class="logo">
        <img th:src="@{/img/pharmacy-icon.png}" alt="Pharmacy Icon" class="logo-small">
    </div>

    <div class="header-center">
        <h1>Umelaphi Yaodian Pharmacy Management System</h1>
    </div>

    <div class="header-right">
        <span th:if="${user != null}" class="user-info">ğŸ‘¤ <strong th:text="${user.name}"></strong></span>
        <a href="/logout" class="logout-btn">ğŸšª Logout</a>
    </div>
</header>

<nav class="navbar">
    <a href="/dashboard" class="active">ğŸ  Dashboard</a>
    <a href="/profile" class="active">ğŸ›  Modify Profile</a>
    <a href="/agents">ğŸ‘¥ Manage Agents</a>
</nav>

<main class="container fade-in">

    <!-- Messages erreurs -->
    <div th:if="${param.error}" class="alert alert-error">
        <span th:switch="${param.error[0]}">
            <span th:case="'already_inactive'">âš ï¸ Ce compte est dÃ©jÃ  dÃ©sactivÃ©.</span>
            <span th:case="'unauthorized'">â›” Action non autorisÃ©e.</span>
            <span th:case="*">âŒ Une erreur est survenue.</span>
        </span>
    </div>

    <!-- Messages succÃ¨s -->
    <div th:if="${param.success}" class="alert alert-success">
        <span th:switch="${param.success[0]}">
            <span th:case="'deactivated'">âœ… Le compte a Ã©tÃ© dÃ©sactivÃ© avec succÃ¨s.</span>
        </span>
    </div>

    <h2 style="text-align:center; margin-bottom: 25px;">
        ğŸ“„ Liste des agents
    </h2>

    <!-- Barre de recherche -->
    <form method="get" action="/agents" class="search-bar">
        <input type="text"
               class="search-input"
               name="search"
               placeholder="ğŸ” Rechercher par nom"
               th:value="${search}">
        
        <button type="submit" class="btn-primary search-btn">Rechercher</button>
    </form>

    <!-- Tableau -->
    <table class="recent-table" style="margin-top:20px; width:100%;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nom</th>
                <th>Email</th>
                <th>RÃ´le</th>
                <th>Actif ?</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            <tr th:each="a : ${agents}">
                <td th:text="${a.id}"></td>
                <td th:text="${a.name}"></td>
                <td th:text="${a.email}"></td>
                <td th:text="${a.role}"></td>

                <td>
                    <span th:if="${a.active}">âœ”</span>
                    <span th:if="${!a.active}">âœ–</span>
                </td>

                <td>
                    <a th:href="@{'/agents/update/' + ${a.id}}" class="btn-small">âœï¸ Modifier</a>
                    |
                    <a th:href="@{'/agents/deactivate/' + ${a.id}}"
                       class="btn-small danger deactivate-link">ğŸš« DÃ©sactiver</a>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="btn1">
        <a href="/agents/register">
            â• Ajouter un agent
        </a>
    </div>

</main>

<!-- Modal confirm -->
<div id="confirmModal" class="modal">
    <div class="modal-content">
        <h3>ğŸš« DÃ©sactiver lâ€™agent ?</h3>
        <p>ÃŠtes-vous sÃ»r de vouloir dÃ©sactiver cet agent ?</p>

        <div class="modal-buttons">
            <button id="confirmYes" class="btn-danger">Oui, dÃ©sactiver</button>
            <button id="confirmNo" class="btn-secondary">Annuler</button>
        </div>
    </div>
</div>

<script>
let deactivateUrl = null;

document.querySelectorAll(".deactivate-link").forEach(link => {
    link.addEventListener("click", function (event) {
        event.preventDefault();
        deactivateUrl = this.getAttribute("href");
        document.getElementById("confirmModal").style.display = "flex";
    });
});

document.getElementById("confirmNo").onclick = function () {
    document.getElementById("confirmModal").style.display = "none";
};

document.getElementById("confirmYes").onclick = function () {
    window.location.href = deactivateUrl;
};
</script>

<footer class="footer">
    <p>Â© 2025 UYP Pharmacy Management System | University of Ottawa</p>
</footer>

</body>
</html>
